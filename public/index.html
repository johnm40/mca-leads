<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Free MCA Lead Finder</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
/* ===== GLOBAL STYLE ===== */
body {
    background:#0B0F17;
    color:white;
    font-family: 'Inter', sans-serif;
    margin:0;
    padding:0;
}

/* Header */
header {
    text-align:center;
    padding:30px 0 15px;
    font-size:38px;
    font-weight:700;
    color:#F2C94C;
}

/* Search Bar Container */
.search-box {
    display:flex;
    gap:12px;
    justify-content:center;
    padding:10px;
}
.search-input {
    width:60%;
    padding:18px;
    font-size:20px;
    border:2px solid #222;
    border-radius:8px;
    background:#111720;
    color:white;
}
.search-btn {
    background:#F2C94C;
    border:none;
    padding:18px 26px;
    border-radius:8px;
    font-size:20px;
    cursor:pointer;
    font-weight:600;
}

/* Filter Bar */
.filters {
    display:flex;
    justify-content:center;
    gap:12px;
    padding:10px;
}
.filters select, .filters input {
    background:#111720;
    color:white;
    padding:12px;
    border-radius:6px;
    border:1px solid #333;
}

/* Sort Buttons */
.sort-row {
    display:flex;
    justify-content:center;
    gap:12px;
    padding:12px;
}
.sort-btn {
    background:#1F2A38;
    color:white;
    padding:12px 16px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    font-size:14px;
}
.sort-btn:hover { background:#F2C94C; color:black; }

/* Results List */
.lead-card {
    background:#111720;
    border-left:5px solid #F2C94C;
    margin:14px auto;
    width:80%;
    padding:16px;
    border-radius:8px;
}
.lead-field { margin:6px 0; font-size:15px; }

/* Edit Icon */
.edit-btn {
    color:#F2C94C;
    cursor:pointer;
    font-size:14px;
    padding-left:5px;
}

/* Save Lead Button */
.save-btn {
    background:#16A085;
    color:white;
    padding:10px 16px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    margin-top:10px;
}
.save-btn:hover { background:#1ABC9C; }

/* Pagination */
.pagination {
    display:flex;
    justify-content:center;
    gap:8px;
    margin-top:20px;
}
.page-btn {
    padding:8px 12px;
    border-radius:5px;
    background:#1F2A38;
    cursor:pointer;
}
.page-btn:hover { background:#F2C94C; color:black; }

/* ===== WATCHLIST SLIDER ===== */
.watchlist-tab {
    position:fixed;
    right:0;
    top:40%;
    background:#F2C94C;
    color:black;
    padding:10px 16px;
    border-radius:8px 0 0 8px;
    font-weight:700;
    cursor:pointer;
    z-index:10;
}

.watchlist {
    position:fixed;
    top:0;
    right:-350px;
    width:320px;
    height:100vh;
    background:#F7D774;
    border-left:4px solid #F2C94C;
    transition:0.3s;
    padding:20px;
    overflow-y:auto;
    font-size:14px;
}
.watchlist.open { right:0; }
.watch-item {
    background:white;
    color:black;
    padding:10px;
    border-radius:6px;
    margin-bottom:10px;
}
.delete-btn {
    background:#C0392B;
    color:white;
    padding:4px 8px;
    border:none;
    border-radius:4px;
    cursor:pointer;
}
.csv-btn {
    margin-top:10px;
    background:#2D3436;
    color:#F2C94C;
    border:none;
    padding:10px;
    width:100%;
    border-radius:6px;
    cursor:pointer;
}
</style>
</head>

<body>
<header>Free MCA Lead Finder</header>

<div class="search-box">
    <input id="searchInput" class="search-input" placeholder="Search business (restaurant, contractor...)" />
    <button class="search-btn" onclick="searchLeads()">Find Leads</button>
</div>

<div class="filters">
    <select id="stateFilter">
        <option value="">All States</option>
        <option value="CA">CA</option><option value="TX">TX</option>
        <option value="NY">NY</option><option value="FL">FL</option>
        <option value="VA">VA</option><option value="GA">GA</option>
    </select>

    <input id="minRevenue" placeholder="Min Revenue" />
    <input id="maxRevenue" placeholder="Max Revenue" />
    <input id="filedDate" type="date" />
</div>

<div class="sort-row">
    <button class="sort-btn" onclick="sortRevenueLow()">‚¨á Revenue Low ‚Üí High</button>
    <button class="sort-btn" onclick="sortRevenueHigh()">‚¨Ü Revenue High ‚Üí Low</button>
</div>

<!-- Results -->
<div id="results"></div>

<div class="pagination">
    <button class="page-btn" onclick="prevPage()">Prev</button>
    <span id="pageInfo"></span>
    <button class="page-btn" onclick="nextPage()">Next</button>
</div>

<!-- Watchlist Slider -->
<div class="watchlist-tab" onclick="toggleWatchlist()">Saved Leads ‚ñ∂</div>

<div id="watchlist" class="watchlist">
    <h3>Saved Leads</h3>
    <div id="watchItems"></div>
    <button class="csv-btn" onclick="downloadCSV()">‚¨á Download CSV</button>
</div>

<script>
let results=[], page=1, perPage=100;

async function searchLeads(){
    const term=document.getElementById("searchInput").value;
    const res=await fetch(`/api/leads?query=${encodeURIComponent(term)}`);
    results=await res.json();
    renderResults();
}

function renderResults(){
    const start=(page-1)*perPage;
    const show=results.slice(start,start+perPage);
    document.getElementById("pageInfo").innerText=`Page ${page}`;
    
    document.getElementById("results").innerHTML=show.map(x=>`
        <div class="lead-card">
            <div class="lead-field"><b>${x.name||'N/A'}</b> 
                <span class="edit-btn" onclick="editField('${x.id}','name')">‚úè</span>
            </div>
            <div class="lead-field">üìç ${x.address||'N/A'}</div>
            <div class="lead-field">üìû ${x.phone||'N/A'}</div>
            <div class="lead-field">üåê ${x.website||'N/A'}</div>
            <div class="lead-field">üë§ Owner: ${x.owner||'N/A'}
                <span class="edit-btn" onclick="editField('${x.id}','owner')">‚úè</span>
            </div>
            <div class="lead-field">üí∞ Est Revenue: ${x.revenue||'N/A'}</div>
            <div class="lead-field">üìÖ Filed: ${x.filed||'N/A'}</div>
            <button class="save-btn" onclick="saveLead(${JSON.stringify(x)})">+ Save Lead</button>
        </div>
    `).join("");
}

function nextPage(){ if(page*perPage < results.length){ page++; renderResults(); }}
function prevPage(){ if(page>1){ page--; renderResults(); }}

let saved=[];

function saveLead(x){
    saved.push(x);
    renderSaved();
}

function renderSaved(){
    document.getElementById("watchItems").innerHTML=saved.map((x,i)=>`
        <div class="watch-item">${x.name||''}<br/>
        <small>${x.address||''}</small><br/>
        <button class="delete-btn" onclick="delSaved(${i})">Delete</button></div>
    `).join("");
}

function delSaved(i){ saved.splice(i,1); renderSaved(); }

function toggleWatchlist(){
    document.getElementById("watchlist").classList.toggle("open");
}

function downloadCSV(){
    let csv="Name,Address,Phone,Website,Owner,Revenue,Filed\n";
    saved.forEach(x=>{ csv+=`${x.name},${x.address},${x.phone},${x.website},${x.owner},${x.revenue},${x.filed}\n`;});
    const blob=new Blob([csv],{type:"text/csv"});
    const url=URL.createObjectURL(blob);
    const link=document.createElement("a");
    link.href=url; link.download="leads.csv"; link.click();
}

function editField(id,field){
    const val=prompt(`Enter new ${field}`);
    if(!val)return;
    // TODO API call to update DB ‚Äì you already have routes
}
</script>
</body>
</html>
