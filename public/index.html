<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MCA Lead Finder</title>
<style>
body {
  background: #09101a;
  font-family: Arial, sans-serif;
  color: white;
  margin: 0;
  padding: 0;
}
header {
  padding: 25px;
  font-size: 40px;
  font-weight: bold;
  text-align: center;
  color: #f5d56e;
}
.container {
  width: 90%;
  margin: auto;
}
input, select {
  padding: 12px;
  font-size: 16px;
  width: 100%;
  margin-bottom: 10px;
}
button {
  padding: 12px;
  background: #f5d56e;
  border: none;
  font-size: 18px;
  cursor: pointer;
  width: 100%;
  border-radius: 6px;
  margin-bottom: 15px;
}
.lead-card {
  background: #0f1823;
  border-left: 6px solid #f5d56e;
  padding: 15px;
  margin: 15px 0;
  border-radius: 6px;
}
.small-btn {
  padding: 8px;
  width: auto;
  font-size: 14px;
  margin-right: 8px;
  border-radius: 5px;
  cursor: pointer;
}
.edit { background: #4fb3ff; }
.delete { background: #ff5757; }
.save { background: #58ff87; }
.sidebar {
  position: fixed;
  right: 0;
  top: 0;
  background: #f5d56e;
  width: 260px;
  height: 100vh;
  padding: 10px;
  overflow-y: auto;
  color: #000;
}
.sidebar h3 {
  text-align: center;
}
</style>
</head>

<body>

<header>Free MCA Lead Finder</header>

<div class="container">
  <input id="query" placeholder="Search: contractor, restaurant, LLC etc">
  <button onclick="searchLeads()">Find Leads</button>
  <div id="results"></div>
</div>

<div class="sidebar">
  <h3>Saved Leads</h3>
  <div id="saved-leads"></div>
</div>

<script>
async function searchLeads() {
  const query = document.getElementById("query").value;

  const res = await fetch(`/api/leads?query=${query}`);
  const data = await res.json();

  const box = document.getElementById("results");
  box.innerHTML = "";

  data.results.forEach((biz) => {
    const div = document.createElement("div");
    div.className = "lead-card";
    div.innerHTML = `
      <b>${biz.name}</b><br>
      ğŸ“ ${biz.address || "N/A"}<br>
      ğŸ“ ${biz.phone || "N/A"}<br>
      ğŸŒ ${biz.website || "N/A"}<br>
      âœ‰ï¸ ${biz.email || "N/A"}<br>
      ğŸ‘¤ Owner: ${biz.owner || "N/A"}<br>
      ğŸ’° Revenue: ${biz.revenue || "N/A"}<br>
      ğŸ—“ Filing: ${biz.filed || "N/A"}<br>
      <button class="small-btn save" onclick='saveLead(${JSON.stringify(biz)})'>Save Lead</button>
    `;
    box.appendChild(div);
  });
}

// save lead to DB
async function saveLead(biz) {
  await fetch("/api/leads-save", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(biz)
  });
  loadSaved();
}

// load saved leads to sidebar
async function loadSaved() {
  const res = await fetch("/api/leads-get");
  const data = await res.json();

  const box = document.getElementById("saved-leads");
  box.innerHTML = "";

  data.forEach((biz) => {
    box.innerHTML += `
      <div>
        <b>${biz.name}</b><br>
        <button class="small-btn edit" onclick="editLead(${biz.id})">Edit</button>
        <button class="small-btn delete" onclick="deleteLead(${biz.id})">X</button>
        <hr>
      </div>
    `;
  });
}
loadSaved();

// Delete lead
async function deleteLead(id) {
  await fetch("/api/leads-delete", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({id})
  });
  loadSaved();
}
</script>

</body>
</html>
